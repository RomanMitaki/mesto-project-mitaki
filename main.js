(()=>{"use strict";var e,t={formSelector:".popup__edit-form",fieldsetSelector:".popup__input-container",inputSelector:".popup__item",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__edit-form-error_active"},n=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled","disabled"),t.classList.remove(n.inactiveButtonClass)):(t.setAttribute("disabled","disabled"),t.classList.add(n.inactiveButtonClass))},o=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)},r=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},c=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");r(t)}},a=function(e,t,n){e?t.textContent="Сохранение...":setTimeout((function(){t.textContent=n}),1e3)},i={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"e64a5305-824a-489e-bb1b-82ebc685af79","Content-Type":"application/json"}},u=function(){return fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=document.querySelector(".popup_type_image-zoom"),l=document.querySelector(".popup_type_addcard-form"),d=document.querySelector(".popup_type_edit-form"),p=document.querySelector(".popup_type_edit-avatar"),_=document.querySelector(".profile__info_name"),f=document.querySelector(".profile__info_description"),m=document.querySelector(".profile__avatar"),y=d.querySelector("input[name=name]"),v=d.querySelector("input[name=description]"),S=p.querySelector("input[name=avatar-link]"),h=document.querySelector("#card-template").content,b=document.querySelector(".cards__card-container"),q=l.querySelector("input[name=image-link]"),k=l.querySelector("input[name=place]"),L=s.querySelector(".popup__picture"),C=s.querySelector(".popup__caption"),E=function(e,t,n){b.prepend(function(e,t,n){var r=h.querySelector(".card").cloneNode(!0);return r.querySelector(".card__picture").src=e,r.querySelector(".card__picture").alt=t,r.querySelector(".card__text").textContent=t,r.querySelector(".card__like-counter").textContent=n.likes.length,r.querySelector(".card__like-icon").addEventListener("click",(function(e){var t;e.target.classList.contains("card__like-icon_active")?(function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n._id).then((function(e){r.querySelector(".card__like-counter").textContent=e.likes.length})),e.target.classList.toggle("card__like-icon_active")):((t=n._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){r.querySelector(".card__like-counter").textContent=e.likes.length})),e.target.classList.toggle("card__like-icon_active"))})),r.querySelector(".card__trash-icon").addEventListener("click",(function(e){var t;t=n._id,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})),e.target.closest(".card").remove()})),r.querySelector(".card__pic-button").addEventListener("click",(function(){L.src=e,L.alt=t,C.textContent=t,o(s)})),r}(e,t,n))},g=document.querySelector(".root"),j=document.querySelector(".profile__edit-button"),x=d.querySelector(".popup__edit-form"),A=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__avatar-edit"),B=l.querySelector(".popup__edit-form"),U=p.querySelector(".popup__edit-form");u().then((function(e){m.src=e.avatar,f.textContent=e.about,_.textContent=e.name})).catch((function(e){console.log(e)})),u().then((function(e){var t=e._id;fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){E(e.link,e.name,e),e.owner._id!==t&&document.querySelector(".card__trash-icon").classList.add("card__trash-icon_hidden"),!0===e.likes.some((function(e){return e._id===t}))&&document.querySelector(".card__like-icon").classList.add("card__like-icon_active")}))}))})).catch((function(e){console.log(e)})),j.addEventListener("click",(function(){y.value=_.textContent,v.value=f.textContent,o(d)})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),a(!0,d.querySelector(".popup__submit-button"),"Сохранить"),(t={name:y.value,description:v.value},fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t.name,about:t.description})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){f.textContent=e.about,_.textContent=e.name,r(d)})).catch((function(e){console.log(e)})).finally((function(){a(!1,d.querySelector(".popup__submit-button"),"Сохранить")}))})),A.addEventListener("click",(function(){B.reset(),l.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass),l.querySelector(t.submitButtonSelector).setAttribute("disabled","disabled"),o(l)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),a(!0,l.querySelector(".popup__submit-button"),"Создать"),(t={link:q.value,caption:k.value},fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({link:t.link,name:t.caption})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){E(e.link,e.name,e),r(l)})).catch((function(e){console.log(e)})).finally((function(){a(!1,l.querySelector(".popup__submit-button"),"Создать")}))})),P.addEventListener("click",(function(){U.reset(),p.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass),p.querySelector(t.submitButtonSelector).setAttribute("disabled","disabled"),o(p)})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),a(!0,p.querySelector(".popup__submit-button"),"Сохранить"),(t=S.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){m.src=e.avatar,r(p)})).catch((function(e){console.log(e)})).finally((function(){a(!1,p.querySelector(".popup__submit-button"),"Сохранить")}))})),g.addEventListener("click",(function(e){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup"))&&r(e.target.closest(".popup"))})),e=t,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.fieldsetSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n(o,r,t),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,c,t),n(o,r,t)}))}))}(t,e)}))}))})();