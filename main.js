(()=>{"use strict";var e={formSelector:".popup__edit-form",fieldsetSelector:".popup__input-container",inputSelector:".popup__item",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__edit-form-error_active"},t=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled","disabled"),t.classList.remove(n.inactiveButtonClass)):(t.setAttribute("disabled","disabled"),t.classList.add(n.inactiveButtonClass))},n=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)},o=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)},r=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");o(t)}},c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"e64a5305-824a-489e-bb1b-82ebc685af79","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var i=document.querySelector(".popup_type_image-zoom"),u=document.querySelector("#card-template").content,s=document.querySelector(".cards__card-container"),l=i.querySelector(".popup__picture"),d=i.querySelector(".popup__caption");function p(e,t,n){t.textContent=e.likes.length,n.classList.toggle("card__like-icon_active")}var _,f=function(e,t,o,r){s.prepend(function(e,t,o,r){var s=u.querySelector(".card").cloneNode(!0),_=s.querySelector(".card__picture"),f=s.querySelector(".card__like-counter"),m=s.querySelector(".card__like-icon");return _.src=e,_.alt=t,s.querySelector(".card__text").textContent=t,f.textContent=o.likes.length,o.owner._id!==r&&s.querySelector(".card__trash-icon").classList.add("card__trash-icon_hidden"),!0===o.likes.some((function(e){return e._id===r}))&&s.querySelector(".card__like-icon").classList.add("card__like-icon_active"),m.addEventListener("click",(function(e){var t;e.target.classList.contains("card__like-icon_active")?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(o._id).then((function(e){p(e,f,m)})).catch((function(e){console.log(e)})):(t=o._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:c.headers}).then(a)).then((function(e){p(e,f,m)})).catch((function(e){console.log(e)}))})),s.querySelector(".card__trash-icon").addEventListener("click",(function(e){var t;t=o._id,fetch("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers}).then(a),e.target.closest(".card").remove()})),s.querySelector(".card__pic-button").addEventListener("click",(function(){l.src=e,l.alt=t,d.textContent=t,n(i)})),s}(e,t,o,r))},m=function(e,t,n){e?t.textContent="Сохранение...":setTimeout((function(){t.textContent=n}),1e3)},y=[fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a)],v=document.querySelector(".root"),S=document.querySelector(".popup_type_addcard-form"),h=document.querySelector(".popup_type_edit-form"),b=document.querySelector(".popup_type_edit-avatar"),q=document.querySelector(".profile__info_name"),L=document.querySelector(".profile__info_description"),k=document.querySelector(".profile__avatar"),C=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__avatar-edit"),x=h.querySelector("input[name=name]"),A=h.querySelector("input[name=description]"),B=h.querySelector(".popup__edit-form"),U=b.querySelector("input[name=avatar-link]"),T=b.querySelector(".popup__edit-form"),P=S.querySelector(".popup__edit-form"),D=S.querySelector("input[name=image-link]"),j=S.querySelector("input[name=place]");Promise.all(y).then((function(e){var t=e[0]._id;k.src=e[0].avatar,L.textContent=e[0].about,q.textContent=e[0].name,e[1].reverse().forEach((function(e){f(e.link,e.name,e,t)})).catch((function(e){console.log(e)}))})),C.addEventListener("click",(function(){x.value=q.textContent,A.value=L.textContent,n(h)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),m(!0,h.querySelector(".popup__submit-button"),"Сохранить"),(t={name:x.value,description:A.value},fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t.name,about:t.description})}).then(a)).then((function(e){L.textContent=e.about,q.textContent=e.name,o(h)})).catch((function(e){console.log(e)})).finally((function(){m(!1,h.querySelector(".popup__submit-button"),"Сохранить")}))})),E.addEventListener("click",(function(){P.reset(),S.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),S.querySelector(e.submitButtonSelector).setAttribute("disabled","disabled"),n(S)})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),m(!0,S.querySelector(".popup__submit-button"),"Создать"),(t={link:D.value,caption:j.value},fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({link:t.link,name:t.caption})}).then(a)).then((function(e){f(e.link,e.name,e,e.owner._id),o(S)})).catch((function(e){console.log(e)})).finally((function(){m(!1,S.querySelector(".popup__submit-button"),"Создать")}))})),g.addEventListener("click",(function(){T.reset(),b.querySelector(e.submitButtonSelector).classList.add(e.inactiveButtonClass),b.querySelector(e.submitButtonSelector).setAttribute("disabled","disabled"),n(b)})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),m(!0,b.querySelector(".popup__submit-button"),"Сохранить"),(t=U.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){k.src=e.avatar,o(b)})).catch((function(e){console.log(e)})).finally((function(){m(!1,b.querySelector(".popup__submit-button"),"Сохранить")}))})),v.addEventListener("click",(function(e){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup"))&&o(e.target.closest(".popup"))})),_=e,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(_.fieldsetSelector)).forEach((function(e){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,c,n),t(o,r,n)}))}))}(e,_)}))}))})();